name: Update Notion News

on:
  schedule:
    - cron: '0 * * * *'  # Runs every hour
  workflow_dispatch:      # Allows manual trigger

jobs:
  notion_sync:
    runs-on: ubuntu-latest

    env:
      RSS_URL: "http://export.arxiv.org/rss/astro-ph.CO"
      K: "5"
      SOURCE: "arXiv astro-ph.CO"
      NOTION_TOKEN: ${{ secrets.NOTION_TOKEN }}
      DATABASE_ID: ${{ secrets.DATABASE_ID }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          pip install --upgrade pip
          pip install feedparser
          pip install notion-client==1.0.0  # v1.x compatible with your current script

      - name: Check Notion secrets
        run: |
          echo "DATABASE_ID length: ${DATABASE_ID}"
          if [ -z "${NOTION_TOKEN}" ]; then
            echo "ERROR: NOTION_TOKEN is empty!"
            exit 1
          else
            echo "NOTION_TOKEN is set."
          fi

      - name: Run Notion RSS Sync
        run: python notion_news_sync/notion_news.py
